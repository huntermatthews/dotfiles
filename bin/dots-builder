#! /usr/bin/env fish  

set DOTS_DEBUG 0
set DOTS ~/projects/new-dotfiles
set DOTS_L ~/projects/new-dotfiles-local/

set DOTS_PROFILE home

function debug_var -a varname
	if [ $DOTS_DEBUG = 1 ] 
		echo "debug '$varname' = '$$varname'" 
	end
end

function blocker 
	set hashes '##################################################'
	echo $hashes
	for line in $argv
		echo "## $line"
	end
	echo $hashes
	echo 
end

debug_var DOTS_DEBUG
debug_var DOTS
debug_var DOTS_L

# Get ALL tehe pattern matched files - including ALL the profiles
set files $DOTS/*/*zshenv

# Dumb but effective - remove ALL the profile related files
set files (string match --entire --invert _profile $files)

set profile_files $DOTS/{$DOTS_PROFILE}_profile/*zshenv

set files $profile_files $files

# cat them all 
set OUT ~/scratch/zshenv.symlink
blocker dots-builer $(date) "Generated file - do not edit!" > $OUT

for file in $files
	[ $DOTS_DEBUG = 1 ] && blocker "original file: $file" >> $OUT
	cat $file >> $OUT
	[ $DOTS_DEBUG = 1 ] && echo \n\n >> $OUT
end 

blocker "end of file" >> $OUT

# EOF